<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>בדיקת התחברות לספריא</title>
  <style>
    body { font-family: sans-serif; direction: rtl; padding: 2em; background: #f8f8f8; }
    pre { background: #eee; padding: 1em; white-space: pre-wrap; direction: ltr; }
    button { padding: 0.5em 1em; font-size: 1em; }
  </style>
</head>
<body>
  <h2>בדיקת התחברות לספריא</h2>
  <p>נשלח ניסיון התחברות עם:</p>
  <ul>
    <li><b>שם משתמש:</b> davidpovarski1@gmail.com</li>
    <li><b>סיסמה:</b> ******** (מוסתרת בקוד, אך תישלח בפועל)</li>
  </ul>

  <button onclick="login()">התחבר עכשיו</button>

  <h3>תשובת השרת:</h3>
  <pre id="response">---</pre>

  <script>
    async function login() {
      const responseBox = document.getElementById("response");

      const email = "davidpovarski1@gmail.com";
      const password = "sefaria";

      try {
        const res = await fetch("https://www.sefaria.org.il/api/profile/login", {
          method: "POST",
          credentials: "include", // שמירת session/cookies
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "" // כאן נדרש CSRF אם יש אותו
          },
          body: JSON.stringify({ email, password })
        });

        const text = await res.text();
        let parsed;

        try {
          parsed = JSON.parse(text);
        } catch {
          parsed = { error: "לא JSON תקני", raw: text };
        }

        responseBox.textContent =
          `סטטוס HTTP: ${res.status} ${res.statusText}\n\n` +
          JSON.stringify(parsed, null, 2);

      } catch (err) {
        responseBox.textContent = "שגיאה כללית:\n" + err.toString();
      }
    }
  </script>
</body>
</html>